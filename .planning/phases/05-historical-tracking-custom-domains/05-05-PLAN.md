---
phase: 05-historical-tracking-custom-domains
plan: 05
type: execute
wave: 4
depends_on: [05-01, 05-02, 05-03, 05-04]
files_modified: []
autonomous: false
requirements: [HIST-01, HIST-02, HIST-03, DOM-03, DOM-04]

must_haves:
  truths:
    - "daily_snapshots and user_domains tables exist in Supabase"
    - "score history chart renders correctly for a real ticker"
    - "trend badge shows correct direction"
    - "custom domain can be created, edited, and deleted"
    - "invalid ticker is rejected with an error message"
  artifacts:
    - path: "backend/app/models/daily_snapshot.py"
      provides: "DailySnapshot model"
    - path: "backend/app/models/user_domain.py"
      provides: "UserDomain + UserDomainTicker models"
    - path: "frontend/src/components/ScoreHistoryChart.tsx"
      provides: "History chart"
    - path: "frontend/src/components/CustomDomainManager.tsx"
      provides: "Domain CRUD UI"
  key_links:
    - from: "frontend/src/pages/HistoryPage.tsx"
      to: "GET /api/history/{ticker}"
      via: "TanStack Query"
      pattern: "useQuery.*history"
    - from: "frontend/src/components/CustomDomainManager.tsx"
      to: "POST /api/domains/custom"
      via: "useMutation"
      pattern: "useMutation.*domains/custom"
---

<objective>
Human verification of all Phase 5 features end-to-end.

Purpose: Confirm all 5 requirements (HIST-01-03, DOM-03-04) are working correctly before closing the phase.
Output: Phase 5 sign-off.
</objective>

<execution_context>
@C:/Users/Yarin David/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Yarin David/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify Phase 5 end-to-end</name>
  <action>No automated action — human verifies all Phase 5 features using the steps below.</action>
  <what-built>
  - daily_snapshots table (HIST-01) with snapshot_job cron at 21:00 UTC
  - GET /api/history/{ticker}?days=30 endpoint
  - ScoreHistoryChart (Recharts LineChart) at /history/:ticker (HIST-02)
  - TrendBadge showing Up/Down/Flat from trend_slope (HIST-03)
  - user_domains + user_domain_tickers tables with RLS (DOM-03)
  - Custom domain CRUD routes + yfinance ticker validation (DOM-04)
  - CustomDomainManager UI at /domains/custom (DOM-03)
  </what-built>
  <how-to-verify>
  1. Supabase dashboard: confirm tables `daily_snapshots`, `user_domains`, `user_domain_tickers` exist
  2. Supabase dashboard: confirm RLS is enabled on user_domains + user_domain_tickers
  3. Navigate to /history/AAPL — page loads without crash; shows chart or "No history available yet."
  4. Navigate to /domains/custom — CustomDomainManager renders
  5. Create a custom domain: name="Test", tickers="AAPL,MSFT" — succeeds and appears in list
  6. Try ticker="FAKE999XYZ" — error message shown with invalid ticker name
  7. Edit domain: change tickers to "AAPL,GOOGL" — saves successfully
  8. Delete domain — disappears from list
  9. Check backend logs: `GET /api/history/AAPL` returns 200
  10. (Optional) Manually trigger snapshot to test DB write:
      `cd backend && python -c "from app.services.snapshot_service import snapshot_job; snapshot_job()"`
      Then refresh /history/AAPL — chart shows data point for today
  </how-to-verify>
  <verify>All 9 checklist items above pass</verify>
  <done>User confirms Phase 5 features work end-to-end</done>
  <resume-signal>Type "approved" to close Phase 5, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
All items in how-to-verify checklist confirmed by user.
</verification>

<success_criteria>
User approves Phase 5 end-to-end: history chart renders, trend badge correct, custom domain CRUD works, invalid tickers rejected.
</success_criteria>

<output>
After approval, create `.planning/phases/05-historical-tracking-custom-domains/05-05-SUMMARY.md` and update STATE.md to reflect Phase 5 complete.
</output>
