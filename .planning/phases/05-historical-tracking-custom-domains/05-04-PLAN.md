---
phase: 05-historical-tracking-custom-domains
plan: 04
type: execute
wave: 3
depends_on: [05-02]
files_modified:
  - frontend/src/components/CustomDomainManager.tsx
  - frontend/src/pages/CustomDomainsPage.tsx
  - frontend/src/router.tsx
autonomous: true
requirements: [DOM-03]

must_haves:
  truths:
    - "User can create a custom domain by entering a name and comma-separated tickers"
    - "Invalid tickers show an error message before submission completes"
    - "User can delete a domain they own"
    - "User can update the tickers in an existing domain"
    - "Custom domains page is accessible from the app navigation"
  artifacts:
    - path: "frontend/src/components/CustomDomainManager.tsx"
      provides: "Create/edit/delete UI for custom domains"
    - path: "frontend/src/pages/CustomDomainsPage.tsx"
      provides: "Page hosting CustomDomainManager"
  key_links:
    - from: "frontend/src/components/CustomDomainManager.tsx"
      to: "POST /api/domains/custom"
      via: "TanStack Query useMutation"
      pattern: "useMutation.*domains/custom"
    - from: "frontend/src/router.tsx"
      to: "frontend/src/pages/CustomDomainsPage.tsx"
      via: "TanStack Router route /domains/custom"
      pattern: "/domains/custom"
---

<objective>
Build the frontend custom domain manager: create, edit, delete user domains with ticker input and validation feedback.

Purpose: DOM-03 — users can define their own peer groups for ranking.
Output: CustomDomainManager component + /domains/custom route.
</objective>

<execution_context>
@C:/Users/Yarin David/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Yarin David/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@frontend/src/router.tsx
@frontend/src/components/StockCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: CustomDomainManager component</name>
  <files>frontend/src/components/CustomDomainManager.tsx</files>
  <action>
Create `frontend/src/components/CustomDomainManager.tsx` using TanStack Query v5 hooks + Tailwind:

State:
- `domains` list from `GET /api/domains/custom` via `useQuery`
- `newName: string`, `newTickers: string` (comma-separated input)
- `editingId: number | null`, `editTickers: string`
- `error: string | null`

Mutations:
- `createMutation` — POST /api/domains/custom `{name, tickers: string[]}` — on 422 set error with invalid ticker list from response detail
- `updateMutation` — PUT /api/domains/custom/{id} `{tickers: string[]}` — on 422 set error
- `deleteMutation` — DELETE /api/domains/custom/{id}

After successful create/update/delete: `queryClient.invalidateQueries(["custom-domains"])`, clear form state.

UI layout (Tailwind, no animation):
- Header: "My Custom Domains"
- Create form: text input for domain name + textarea for tickers (one per line OR comma-separated) + "Create" button
  - Parse tickers: split on comma or newline, trim whitespace, uppercase, filter empty
  - Show `error` below form in red if set
- Domains list: for each domain show name + ticker chips + "Edit" button + "Delete" button
- Edit inline: when editing, show ticker textarea pre-filled + "Save" / "Cancel" buttons
- Ticker chips: small gray badges showing each ticker symbol
- All auth headers attached via existing auth pattern (use same fetch wrapper used elsewhere in the codebase)
  </action>
  <verify>
    cd frontend && npm run build
  </verify>
  <done>Component builds without TypeScript errors; all mutations typed correctly</done>
</task>

<task type="auto">
  <name>Task 2: CustomDomainsPage + router wiring</name>
  <files>frontend/src/pages/CustomDomainsPage.tsx, frontend/src/router.tsx</files>
  <action>
Create `frontend/src/pages/CustomDomainsPage.tsx`:
- Simple page wrapper: `<h1>Custom Domains</h1>` + `<CustomDomainManager />`
- Requires auth — if no user session, redirect to login (use same auth guard pattern as other protected pages)

Wire into `frontend/src/router.tsx`:
- Add route `/domains/custom` → `CustomDomainsPage`
- Add nav link to "My Domains" in whatever navigation component exists (sidebar, navbar, etc.) — place it alongside existing domain-related nav items
  </action>
  <verify>
    cd frontend && npm run build
    # Navigate to /domains/custom → CustomDomainManager renders
    # Unauthenticated access redirects to login
  </verify>
  <done>npm run build passes; /domains/custom route registered and renders; nav link present</done>
</task>

</tasks>

<verification>
- `npm run build` passes with no TypeScript errors
- `/domains/custom` accessible in browser
- Create domain with valid tickers → appears in list
- Create domain with invalid ticker → error message shown
- Delete domain → removed from list
</verification>

<success_criteria>
CustomDomainManager renders on /domains/custom; full CRUD works through the UI; invalid tickers show clear error.
</success_criteria>

<output>
After completion, create `.planning/phases/05-historical-tracking-custom-domains/05-04-SUMMARY.md`
</output>
