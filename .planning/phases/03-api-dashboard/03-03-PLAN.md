---
phase: 03-api-dashboard
plan: "03"
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - frontend/package.json
  - frontend/vite.config.ts
  - frontend/src/main.tsx
  - frontend/src/index.css
  - frontend/src/App.tsx
  - frontend/src/api/client.ts
  - frontend/src/hooks/useMarketOpen.ts
  - frontend/src/components/Skeleton.tsx
  - frontend/src/components/BestOverall.tsx
  - frontend/src/components/DomainSelector.tsx
  - frontend/src/components/StockCard.tsx
  - frontend/src/components/ScoreBreakdown.tsx
autonomous: true
requirements: [UI-01, UI-02, UI-03, UI-04, UI-05]

must_haves:
  truths:
    - "Dashboard shows top 5 stocks per domain in a responsive grid"
    - "Clicking a stock card opens score breakdown with all factor values"
    - "Skeleton placeholders show while data is loading"
    - "Market Closed banner appears outside NYSE trading hours"
    - "Layout is usable on mobile (single column) and desktop (3 columns)"
  artifacts:
    - path: "frontend/src/App.tsx"
      provides: "Root dashboard with TanStack Query polling"
      contains: "useQuery"
    - path: "frontend/src/components/ScoreBreakdown.tsx"
      provides: "Modal/panel with factor breakdown on stock click"
    - path: "frontend/src/hooks/useMarketOpen.ts"
      provides: "isMarketOpen() pure JS function"
    - path: "frontend/vite.config.ts"
      provides: "Tailwind v4 plugin + /api proxy to localhost:8000"
  key_links:
    - from: "frontend/src/App.tsx"
      to: "http://localhost:8000/api/rankings"
      via: "TanStack Query fetch every 5 min"
      pattern: "refetchInterval.*300"
    - from: "frontend/src/components/StockCard.tsx"
      to: "frontend/src/components/ScoreBreakdown.tsx"
      via: "onClick → setSelected state in parent"
      pattern: "onClick"
---

<objective>
Scaffold React frontend and implement all dashboard UI components.

Purpose: Users need a visual interface to browse ranked stocks by domain, view factor breakdowns, and see market status.
Output: Working Vite + React + Tailwind v4 app with DomainSelector, StockCard, ScoreBreakdown, BestOverall, skeleton states, market banner, responsive layout.
</objective>

<execution_context>
@C:/Users/Yarin David/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Yarin David/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Vite app + Tailwind v4 + TanStack Query</name>
  <files>frontend/package.json, frontend/vite.config.ts, frontend/src/main.tsx, frontend/src/index.css, frontend/src/api/client.ts, frontend/src/hooks/useMarketOpen.ts, frontend/src/components/Skeleton.tsx</files>
  <action>
From repo root, scaffold the frontend:
```bash
npm create vite@latest frontend -- --template react-ts
cd frontend
npm install
npm install @tanstack/react-query
npm install tailwindcss @tailwindcss/vite
```

**vite.config.ts** — Add Tailwind v4 plugin (no tailwind.config.js needed) and proxy:
```ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import tailwindcss from '@tailwindcss/vite'

export default defineConfig({
  plugins: [react(), tailwindcss()],
  server: {
    proxy: {
      '/api': 'http://localhost:8000',
    },
  },
})
```

**src/index.css** — Replace contents with just:
```css
@import "tailwindcss";
```
(Tailwind v4 — no @tailwind directives, no config file)

**src/main.tsx** — Wrap with QueryClientProvider:
```tsx
import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
const queryClient = new QueryClient()
// wrap <App /> with <QueryClientProvider client={queryClient}>
```

**src/api/client.ts**:
```ts
export async function fetchRankings() {
  const res = await fetch('/api/rankings')
  if (!res.ok) throw new Error('Failed to fetch rankings')
  return res.json()
}

export async function fetchDomains() {
  const res = await fetch('/api/domains')
  if (!res.ok) throw new Error('Failed to fetch domains')
  return res.json()
}
```

**src/hooks/useMarketOpen.ts**:
```ts
export function isMarketOpen(): boolean {
  const now = new Date()
  const parts = new Intl.DateTimeFormat('en-US', {
    timeZone: 'America/New_York',
    hour: 'numeric', minute: 'numeric', hour12: false, weekday: 'short',
  }).formatToParts(now)
  const p = Object.fromEntries(parts.map(x => [x.type, x.value]))
  const mins = parseInt(p.hour) * 60 + parseInt(p.minute)
  return !['Sat', 'Sun'].includes(p.weekday) && mins >= 570 && mins < 960
}
```

**src/components/Skeleton.tsx**:
```tsx
export function Skeleton({ className }: { className?: string }) {
  return <div className={`animate-pulse rounded bg-gray-200 ${className ?? ''}`} />
}
```
  </action>
  <verify>
```bash
cd frontend && npm run build 2>&1 | tail -5
```
Build succeeds with no errors.
  </verify>
  <done>Frontend builds without errors. Tailwind v4 and TanStack Query installed.</done>
</task>

<task type="auto">
  <name>Task 2: Dashboard components + App.tsx</name>
  <files>frontend/src/components/BestOverall.tsx, frontend/src/components/DomainSelector.tsx, frontend/src/components/StockCard.tsx, frontend/src/components/ScoreBreakdown.tsx, frontend/src/App.tsx</files>
  <action>
**src/components/BestOverall.tsx** — Highlight card for the top stock across all domains:
```tsx
export function BestOverall({ stock }: { stock: StockRanking }) {
  return (
    <div className="rounded-xl border border-yellow-300 bg-yellow-50 p-4 mb-6">
      <p className="text-xs font-semibold text-yellow-600 uppercase tracking-wide mb-1">Best Overall</p>
      <p className="text-xl font-bold">{stock.ticker}</p>
      <p className="text-sm text-gray-600">{stock.composite_score.toFixed(1)} / 100</p>
    </div>
  )
}
```

**src/components/DomainSelector.tsx** — Horizontal scrollable tab list:
```tsx
export function DomainSelector({ domains, active, onSelect }: {
  domains: string[], active: string, onSelect: (d: string) => void
}) {
  return (
    <div className="flex gap-2 overflow-x-auto pb-2 mb-6">
      {domains.map(d => (
        <button
          key={d}
          onClick={() => onSelect(d)}
          className={`px-3 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors
            ${active === d ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
        >
          {d}
        </button>
      ))}
    </div>
  )
}
```

**src/components/StockCard.tsx** — Card showing rank, ticker, score:
```tsx
export function StockCard({ stock, onClick }: { stock: StockRanking, onClick: () => void }) {
  return (
    <button onClick={onClick} className="text-left rounded-xl border border-gray-200 bg-white p-4 shadow-sm hover:shadow-md transition-shadow w-full">
      <div className="flex justify-between items-start mb-2">
        <span className="text-xs text-gray-400">#{stock.rank}</span>
        <span className="text-xs font-semibold text-blue-600">{stock.composite_score.toFixed(1)}</span>
      </div>
      <p className="text-lg font-bold text-gray-900">{stock.ticker}</p>
    </button>
  )
}
```

**src/components/ScoreBreakdown.tsx** — Modal overlay with factor table:
```tsx
export function ScoreBreakdown({ stock, onClose }: { stock: StockRanking, onClose: () => void }) {
  const factors = [
    { label: 'Momentum', value: stock.factors.momentum },
    { label: 'Volume Change', value: stock.factors.volume_change },
    { label: 'Volatility', value: stock.factors.volatility },
    { label: 'Relative Strength', value: stock.factors.relative_strength },
    { label: 'Financial Ratio', value: stock.factors.financial_ratio },
  ]
  return (
    <div className="fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4" onClick={onClose}>
      <div className="bg-white rounded-2xl p-6 max-w-sm w-full shadow-xl" onClick={e => e.stopPropagation()}>
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-xl font-bold">{stock.ticker}</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600 text-xl">✕</button>
        </div>
        <p className="text-3xl font-bold text-blue-600 mb-4">{stock.composite_score.toFixed(1)}<span className="text-sm text-gray-400"> / 100</span></p>
        <table className="w-full text-sm">
          <tbody>
            {factors.map(f => (
              <tr key={f.label} className="border-t border-gray-100">
                <td className="py-2 text-gray-600">{f.label}</td>
                <td className="py-2 text-right font-medium">
                  {f.value != null ? f.value.toFixed(3) : <span className="text-gray-300">N/A</span>}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  )
}
```

**src/App.tsx** — Main dashboard. Use shared types inline (no separate types file needed):
```tsx
import { useState } from 'react'
import { useQuery } from '@tanstack/react-query'
import { fetchRankings } from './api/client'
import { isMarketOpen } from './hooks/useMarketOpen'
import { Skeleton } from './components/Skeleton'
import { BestOverall } from './components/BestOverall'
import { DomainSelector } from './components/DomainSelector'
import { StockCard } from './components/StockCard'
import { ScoreBreakdown } from './components/ScoreBreakdown'

export default function App() {
  const { data, isLoading } = useQuery({
    queryKey: ['rankings'],
    queryFn: fetchRankings,
    refetchInterval: 300_000,
    refetchIntervalInBackground: false,
  })

  const [activeDomain, setActiveDomain] = useState<string | null>(null)
  const [selectedStock, setSelectedStock] = useState<any>(null)

  const domains: any[] = data?.domains ?? []
  const currentDomain = activeDomain ?? domains[0]?.domain ?? null
  const domainNames = domains.map((d: any) => d.domain)
  const currentStocks = domains.find((d: any) => d.domain === currentDomain)?.top5 ?? []

  return (
    <div className="min-h-screen bg-gray-50">
      <div className="max-w-5xl mx-auto px-4 py-8">
        <div className="flex items-center justify-between mb-6">
          <h1 className="text-2xl font-bold text-gray-900">Smart Stock Ranker</h1>
          {!isMarketOpen() && (
            <span className="text-xs font-medium bg-amber-100 text-amber-700 px-3 py-1 rounded-full">
              Market Closed
            </span>
          )}
        </div>

        {isLoading ? (
          <>
            <Skeleton className="h-20 w-full mb-6" />
            <div className="flex gap-2 mb-6">{[...Array(5)].map((_, i) => <Skeleton key={i} className="h-8 w-24" />)}</div>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {[...Array(5)].map((_, i) => <Skeleton key={i} className="h-24" />)}
            </div>
          </>
        ) : (
          <>
            {data?.best_overall && <BestOverall stock={data.best_overall} />}
            <DomainSelector domains={domainNames} active={currentDomain ?? ''} onSelect={setActiveDomain} />
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {currentStocks.map((stock: any) => (
                <StockCard key={stock.ticker} stock={stock} onClick={() => setSelectedStock(stock)} />
              ))}
            </div>
          </>
        )}
      </div>

      {selectedStock && (
        <ScoreBreakdown stock={selectedStock} onClose={() => setSelectedStock(null)} />
      )}
    </div>
  )
}
```
  </action>
  <verify>
```bash
cd frontend && npm run build 2>&1 | tail -10
```
Build succeeds. No TypeScript errors.
  </verify>
  <done>All components created. Frontend builds cleanly. Dev server starts with `npm run dev`.</done>
</task>

</tasks>

<verification>
```bash
cd frontend && npm run build
# Start backend: cd backend && uvicorn app.main:app --reload
# Start frontend: cd frontend && npm run dev
# Visit http://localhost:5173 — dashboard loads, skeleton shows on first load
```
</verification>

<success_criteria>
- Frontend builds without TypeScript errors
- Dashboard shows domain tabs, top-5 cards per domain, BestOverall card
- Skeleton cards visible on load before data arrives
- Clicking a stock opens ScoreBreakdown modal
- Market Closed banner visible outside NYSE hours (9:30am–4pm ET, Mon–Fri)
- Layout is single-column on mobile, 3-column on lg screens
- Polling every 5 minutes (refetchInterval: 300_000)
</success_criteria>

<output>
After completion, create `.planning/phases/03-api-dashboard/03-03-SUMMARY.md`
</output>
