---
phase: 06-devops
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/Dockerfile
  - backend/.dockerignore
  - frontend/Dockerfile
  - frontend/.dockerignore
  - frontend/nginx.conf
  - docker-compose.yml
autonomous: true
requirements: []

must_haves:
  truths:
    - "backend/Dockerfile builds successfully with `docker build ./backend`"
    - "frontend/Dockerfile builds successfully with `docker build ./frontend`"
    - "`docker compose up` starts both services locally"
    - "Frontend container serves SPA — deep routes (e.g. /dashboard) return index.html not 404"
    - "Frontend /api/ requests proxy to backend container"
  artifacts:
    - path: "backend/Dockerfile"
      provides: "Multi-stage Python image — builder deps, slim runtime, uvicorn entrypoint"
    - path: "backend/.dockerignore"
      provides: "Excludes __pycache__, .env, tests from build context"
    - path: "frontend/Dockerfile"
      provides: "Multi-stage node builder + nginx:alpine runtime"
    - path: "frontend/.dockerignore"
      provides: "Excludes node_modules, dist from build context"
    - path: "frontend/nginx.conf"
      provides: "SPA try_files routing + /api/ proxy to backend:8001"
    - path: "docker-compose.yml"
      provides: "Local dev stack — backend (8001) + frontend (80)"
  key_links:
    - from: "frontend/Dockerfile"
      to: "frontend/nginx.conf"
      via: "COPY nginx.conf /etc/nginx/conf.d/default.conf"
    - from: "frontend/nginx.conf"
      to: "backend container"
      via: "proxy_pass http://backend:8001"
    - from: "docker-compose.yml"
      to: "backend/.env"
      via: "env_file: ./backend/.env"
---

<objective>
Dockerize both services and add Docker Compose for local dev.

Purpose: Required for CI Docker build job and for reproducing production locally.
Output: backend/Dockerfile, frontend/Dockerfile, nginx.conf, docker-compose.yml, .dockerignore files.
</objective>

<execution_context>
@C:/Users/Yarin David/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Yarin David/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Backend Dockerfile + .dockerignore</name>
  <files>backend/Dockerfile, backend/.dockerignore</files>
  <action>
Create `backend/Dockerfile` as a two-stage build:

Stage 1 (builder): `FROM python:3.12-slim AS builder`, WORKDIR /app, COPY requirements.txt, RUN `pip install --no-cache-dir --prefix=/install -r requirements.txt`.

Stage 2 (runtime): `FROM python:3.12-slim`, WORKDIR /app, COPY --from=builder /install /usr/local, COPY app/ ./app/, ENV PYTHONUNBUFFERED=1, EXPOSE 8001, CMD `["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8001"]`.

Create `backend/.dockerignore`:
```
__pycache__
*.pyc
*.pyo
.env
.env.*
tests/
alembic/
alembic.ini
*.log
.pytest_cache
```
  </action>
  <verify>docker build -t backend-test ./backend (from project root — must exit 0)</verify>
  <done>Image builds successfully; `docker run --rm backend-test uvicorn --version` prints uvicorn version</done>
</task>

<task type="auto">
  <name>Task 2: Frontend Dockerfile + nginx.conf + .dockerignore</name>
  <files>frontend/Dockerfile, frontend/nginx.conf, frontend/.dockerignore</files>
  <action>
Create `frontend/Dockerfile` as a two-stage build:

Stage 1 (builder): `FROM node:22-alpine AS builder`, WORKDIR /app, COPY package*.json ./, RUN `npm ci`, COPY . ., RUN `npm run build`.

Stage 2 (runtime): `FROM nginx:alpine`, COPY --from=builder /app/dist /usr/share/nginx/html, COPY nginx.conf /etc/nginx/conf.d/default.conf, EXPOSE 80.

Create `frontend/nginx.conf`:
```nginx
server {
    listen 80;
    root /usr/share/nginx/html;
    index index.html;

    location /api/ {
        proxy_pass http://backend:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

Create `frontend/.dockerignore`:
```
node_modules
dist
.env
.env.*
*.log
```
  </action>
  <verify>docker build -t frontend-test ./frontend (from project root — must exit 0)</verify>
  <done>Image builds successfully; `docker run --rm -p 8080:80 frontend-test` serves static files (curl http://localhost:8080 returns HTML)</done>
</task>

<task type="auto">
  <name>Task 3: Docker Compose for local dev</name>
  <files>docker-compose.yml</files>
  <action>
Create `docker-compose.yml` at project root:

```yaml
services:
  backend:
    build:
      context: ./backend
    env_file: ./backend/.env
    ports:
      - "8001:8001"

  frontend:
    build:
      context: ./frontend
    ports:
      - "80:80"
    depends_on:
      - backend
```

No version field (deprecated in Compose v2). Services named `backend` and `frontend` — nginx.conf proxy_pass references `backend` by service name (Docker internal DNS).
  </action>
  <verify>docker compose config (validates YAML syntax, exits 0)</verify>
  <done>`docker compose config` exits 0 with valid output; docker-compose.yml exists at project root</done>
</task>

</tasks>

<verification>
From project root:
- `docker build -t backend-test ./backend` — exits 0
- `docker build -t frontend-test ./frontend` — exits 0
- `docker compose config` — exits 0
</verification>

<success_criteria>
Both Dockerfiles build without error. Docker Compose config is valid. nginx.conf has try_files for SPA routing and /api/ proxy_pass to backend:8001.
</success_criteria>

<output>
After completion, create `.planning/phases/06-devops-ci-cd-pipeline-docker-containerization-github-actions-deployment-configuration/06-01-SUMMARY.md`
</output>
