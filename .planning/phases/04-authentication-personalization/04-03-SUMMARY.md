---
phase: 04-authentication-personalization
plan: "03"
subsystem: frontend-auth
tags: [auth, tanstack-router, supabase, protected-routes]
dependency_graph:
  requires: [04-01, 04-02]
  provides: [login-page, protected-routes, session-persistence, logout]
  affects: [frontend/src/main.tsx, frontend/src/routes]
tech_stack:
  added: ["@supabase/supabase-js", "@tanstack/react-router", "@tanstack/router-vite-plugin"]
  patterns: [file-based-routing, beforeLoad-auth-guard, session-persistence]
key_files:
  created:
    - frontend/src/lib/supabase.ts
    - frontend/src/routes/__root.tsx
    - frontend/src/routes/index.tsx
    - frontend/src/routes/login.tsx
    - frontend/src/routes/_authenticated/route.tsx
    - frontend/src/routes/_authenticated/dashboard.tsx
    - frontend/src/routeTree.gen.ts
  modified:
    - frontend/src/main.tsx
    - frontend/vite.config.ts
decisions:
  - "TanStackRouterVite plugin handles routeTree.gen.ts auto-generation on build"
  - "/ route uses beforeLoad to redirect to dashboard or /login based on session"
  - "Logout uses window.location.href to force full page reload clearing React state"
metrics:
  duration: 15min
  completed: "2026-02-20"
---

# Phase 04 Plan 03: TanStack Router Auth Routes Summary

Supabase client singleton + TanStack Router file-based routing with login/register page and protected dashboard layout.

## What Was Built

| Item | Detail |
|------|--------|
| Supabase client | `src/lib/supabase.ts` — singleton with persistSession + autoRefreshToken |
| Login page | `/login` — email/password form with login/register mode toggle |
| Root redirect | `/` — beforeLoad redirects authenticated → dashboard, unauthenticated → /login |
| Auth guard | `/_authenticated/route.tsx` — beforeLoad checks session, redirects to /login if absent |
| Dashboard route | `/_authenticated/dashboard.tsx` — full dashboard with user display name + logout dropdown |
| routeTree.gen.ts | Auto-generated by TanStackRouterVite plugin on build |

## Decisions Made

- TanStackRouterVite plugin in vite.config.ts generates routeTree.gen.ts automatically
- `/_authenticated` layout route pattern wraps all protected routes via Outlet
- Logout button uses `window.location.href = '/login'` after signOut to clear React state

## Deviations from Plan

None - plan executed exactly as written.

## Self-Check

- [x] `frontend/src/lib/supabase.ts` exists
- [x] `frontend/src/routes/login.tsx` exists with signUp + signInWithPassword
- [x] `frontend/src/routes/_authenticated/route.tsx` has beforeLoad getSession
- [x] `frontend/src/routes/_authenticated/dashboard.tsx` has logout button
- [x] `npm run build` exits 0 with no TypeScript errors
