---
phase: 04-authentication-personalization
plan: 05
type: execute
wave: 4
depends_on: [04-04]
files_modified: []
autonomous: false
requirements: [AUTH-01, AUTH-02, AUTH-03, AUTH-04]

must_haves:
  truths:
    - "User can register a new account and is redirected to the dashboard"
    - "User can log in with existing credentials and is redirected to the dashboard"
    - "Unauthenticated user visiting / is redirected to /login"
    - "Logged-in user visiting /login is redirected to /"
    - "Display name appears in the header after login"
    - "Domain selection change auto-saves without a save button"
    - "After logout and re-login, the previously selected domain is restored"
    - "Session survives a browser tab close and reopen"
  artifacts:
    - path: "frontend/src/routes/login.tsx"
      provides: "Login/register page"
    - path: "frontend/src/routes/_authenticated/dashboard.tsx"
      provides: "Protected dashboard with preferences"
  key_links:
    - from: "browser"
      to: "frontend/src/routes/_authenticated/route.tsx"
      via: "TanStack Router beforeLoad guard"
      pattern: "getSession"
---

<objective>
Human verification of the complete authentication and personalization flow.

Purpose: Confirms all AUTH requirements work end-to-end in a real browser with real Supabase credentials.
Output: Verified auth flow; phase 04 marked complete.
</objective>

<execution_context>
@C:/Users/Yarin David/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Yarin David/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/04-authentication-personalization/04-CONTEXT.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete auth + personalization system:
    - Register/login page at /login with tab toggle
    - Protected dashboard at /_authenticated/dashboard (redirects to /login if unauthed)
    - Display name in header with logout dropdown
    - Domain preference auto-save on change, restored on login
    - Session persists across tab close (localStorage)
  </what-built>
  <how-to-verify>
    Ensure backend and frontend are running:
    - Backend: `cd backend && uvicorn app.main:app --reload`
    - Frontend: `cd frontend && npm run dev`

    Test the following flows in order:

    1. **Redirect guard** — Visit http://localhost:5173/ in an incognito window. Confirm you are redirected to /login.

    2. **Register** — On /login, switch to "Register" tab. Enter email, password, and display name. Click "Create account". Confirm redirect to /_authenticated/dashboard and display name appears in the header.

    3. **Domain auto-save** — On the dashboard, click a different domain tab. No save button needed. Verify the selection feels instant.

    4. **Logout** — Hover the display name chip in the header; click Logout. Confirm redirect to /login.

    5. **Login + preference restore** — Log back in with same credentials. Confirm the domain tab selected last is still active (not the default first domain).

    6. **Session persistence** — While logged in, close the browser tab. Open http://localhost:5173/ in a new tab. Confirm you land on the dashboard (not /login) without re-entering credentials.

    7. **Login redirect** — While logged in, visit http://localhost:5173/login directly. Confirm redirect to /.

    8. **Invalid credentials** — Log out. Try to log in with wrong password. Confirm error message appears inline below the password field (not an alert/modal).
  </how-to-verify>
  <resume-signal>Type "approved" if all 8 flows work, or describe which step fails.</resume-signal>
</task>

</tasks>

<verification>
All 8 manual flows pass.
</verification>

<success_criteria>
All AUTH-01 through AUTH-04 requirements verified working in a real browser session.
</success_criteria>

<output>
After completion, create `.planning/phases/04-authentication-personalization/04-05-SUMMARY.md`
</output>
